{"version":3,"sources":["routes.js","TaoEventLog/show/layout!tpl","TaoEventLog/show.js"],"names":["define","TaoEventLog","actions","index","hb","template","Handlebars","depth0","helpers","partials","data","this","compilerInfo","merge","helper","options","buffer","helperMissing","escapeExpression","__","hash","call","$","datatable","layoutTpl","listUrl","_url","start","$layout","$eventList","$eventViewer","updateEventDetails","event","k","hasOwnProperty","json","JSON","parse","str","stringify","undefined","html","append","url","filter","rowSelection","model","id","label","sortable","filterable","transform","roles","row","list","split","roles_list","join","shift","listeners","selected","e","removeClass","page","on","trigger"],"mappings":"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A,WAEApC,QAAAqC,QAAA;AF5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA,ADgCA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA,AD2BA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"taoEventLog/controller/routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\n *\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\n */\n\ndefine('taoEventLog/controller/routes',[],function () {\n    'use strict';\n\n    return {\n        'TaoEventLog': {\n            'actions': {\n                'index': 'controller/TaoEventLog/show'\n            }\n        }\n    };\n});\n\n","\ndefine('tpl!taoEventLog/controller/TaoEventLog/show/layout', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"log\\\">\\n    <section class=\\\"log-browser\\\">\\n        <div class=\\\"filters\\\"></div>\\n        <div class=\\\"log-table\\\"></div>\\n    </section>\\n    <section class=\\\"event-viewer hidden\\\">\\n        \\n        <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Event\", options) : helperMissing.call(depth0, \"__\", \"Event\", options)))\n    + \" #<span class=\\\"id\\\"></span></h2>\\n        \\n        <ul class=\\\"list\\\">\\n            <li><strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Event Name\", options) : helperMissing.call(depth0, \"__\", \"Event Name\", options)))\n    + \"</strong>: <span class=\\\"event_name\\\"></span></li>\\n            <li><strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Action\", options) : helperMissing.call(depth0, \"__\", \"Action\", options)))\n    + \"</strong>: <span class=\\\"action\\\"></span></li>\\n            <li><strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"User ID\", options) : helperMissing.call(depth0, \"__\", \"User ID\", options)))\n    + \"</strong>: <span class=\\\"user_id\\\"></span></li>\\n            <li><strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"User Roles\", options) : helperMissing.call(depth0, \"__\", \"User Roles\", options)))\n    + \"</strong>: <span class=\\\"user_roles\\\"></span></li>\\n            <li><strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Occurred\", options) : helperMissing.call(depth0, \"__\", \"Occurred\", options)))\n    + \"</strong>: <span class=\\\"occurred\\\"></span></li>\\n        </ul>\\n\\n        <p><strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Properties\", options) : helperMissing.call(depth0, \"__\", \"Properties\", options)))\n    + \"</strong>:</p>\\n        <div class=\\\"code properties\\\"></div>\\n    </section>\\n</div>\\n\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\n *\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\n */\n\ndefine('taoEventLog/controller/TaoEventLog/show',[\n    'jquery',\n    'i18n',\n    'helpers',\n    'ui/datatable',\n    'tpl!taoEventLog/controller/TaoEventLog/show/layout'\n], function ($, __, helpers, datatable, layoutTpl) {\n    'use strict';\n\n    //the endpoints\n    var listUrl = helpers._url('search', 'TaoEventLog', 'taoEventLog');\n\n    return {\n\n        /**\n         * Controller entry point\n         */\n        start: function start() {\n\n            var $layout = $(layoutTpl());\n            var $eventList = $('.log-browser .log-table', $layout);\n            var $eventViewer = $('.event-viewer', $layout);\n            \n            var updateEventDetails = function updateEventDetails(event) {\n                for (var k in event) {\n                    if (event.hasOwnProperty(k)) {\n                        if (k == 'properties') {\n                            var json = JSON.parse(JSON.parse(event[k]));\n                            var str = JSON.stringify(json, undefined, 2);\n                            $('.' + k, $eventViewer).html(\n                                '<pre>' + str + '</pre>'\n                            );\n                        } else if (k == 'user_roles') {\n                            $('.' + k, $eventViewer).html(event['roles_list']);\n                        } else {\n                            $('.' + k, $eventViewer).html(event[k]);\n                        }\n                    }\n                }\n            };\n\n            //append the layout to the current view container\n            $('.content').append($layout);\n            \n            //set up the student list\n            $eventList.datatable({\n                url: listUrl,\n                filter: true,\n                rowSelection: true,\n                model: [{\n                    id: 'event_name',\n                    label: __('Event Name'),\n                    sortable: true,\n                    filterable: true\n                },{\n                    id: 'action',\n                    label: __('Action'),\n                    sortable: true,\n                    filterable: true\n                },{\n                    id: 'user_id',\n                    label: __('User ID'),\n                    sortable: true,\n                    filterable: true\n                }, {\n                    id: 'user_roles',\n                    label: __('User Roles'),\n                    sortable: true,\n                    filterable: true,\n                    transform: function(roles, row) {\n                        var list = [''];\n\n                        if (roles) {\n                            list = roles.split(',');\n                        }\n\n                        row.roles_list = list.join('<br>');\n\n                        return list.shift();\n                    }\n                }, {\n                    id: 'occurred',\n                    label: __('Occurred'),\n                    sortable: true,\n                    filterable: true\n                }],\n                \n                listeners: {\n                    /**\n                     * When a row is selected, we update the student viewer\n                     */\n                    selected: function selectRow(e, event) {\n                        updateEventDetails(event);\n\n                        //the 1st time it comes hidden\n                        $eventViewer.removeClass('hidden');\n                    },\n\n                    /**\n                     * Set pagination to start position when using filtering\n                     * @param e\n                     * @param options\n                     */\n                    filter: function filtered(e, options) {\n                        options.page = 1;\n                    }\n\n                }\n            }).on('create.datatable', function () {\n                // the page is now ready\n                $layout.trigger('dispatched');\n            });\n        }\n    };\n});\n\n"]}