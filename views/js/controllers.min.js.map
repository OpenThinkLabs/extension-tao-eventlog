{"version":3,"sources":["routes.js","TaoEventLog/show/layout!tpl","../components/export/templates/layout!tpl","../components/export/exporter.js","../components/export/modalExporter.js","TaoEventLog/show.js"],"names":["define","TaoEventLog","actions","index","hb","template","Handlebars","depth0","helpers","partials","data","program1","stack1","helper","buffer","title","call","hash","functionType","escapeExpression","key","this","compilerInfo","merge","options","helperMissing","self","__","each","dataTypes","inverse","noop","fn","program","$","_","component","feedback","loadingBar","layoutTpl","url","logoutEvent","isPlainObject","isString","exportUrl","TypeError","setTemplate","on","$form","$component","find","e","preventDefault","start","params","serializeArray","param","name","value","build","fileDownload","successCallback","stop","modal","failCallback","jqXHR","response","parseJSON","text","error","Error","message","init","exporter","feedbackOptions","timeout","warning","encodeHtml","err","addClass","width","render","datatable","dateRangeFactory","listUrl","_url","$layout","$eventFilter","$eventList","$eventViewer","$exportLink","$filterRange","pickerType","renderTo","pickerConfig","dateFormat","timeFormat","periodStart","getStart","periodEnd","getEnd","updateEventDetails","event","k","hasOwnProperty","json","JSON","parse","str","stringify","undefined","html","split","join","append","sortby","sortorder","filter","rowSelection","filterStrategy","model","id","label","transform","row","raw","sortable","filterable","roles","shift","listeners","selected","removeClass","page","trigger"],"mappings":"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","file":"routes.js.map","sourcesContent":["/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\r\n */\r\n\r\ndefine('taoEventLog/controller/routes',[],function () {\r\n    'use strict';\r\n\r\n    return {\r\n        'TaoEventLog': {\r\n            'actions': {\r\n                'index': 'controller/TaoEventLog/show'\r\n            }\r\n        }\r\n    };\r\n});\r\n\n","\ndefine('tpl!taoEventLog/controller/TaoEventLog/show/layout', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n                \\r\\n                    <div class=\\\"grid-row\\\">\\r\\n                        <div class=\\\"col-12\\\">\\r\\n                            <strong>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</strong>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"grid-row\\\">\\r\\n                        <div class=\\\"col-10 desc\\\">\\r\\n                            <span class=\\\"\";\n  if (helper = helpers.key) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.key); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></span>\\r\\n                        </div>\\r\\n                    </div>\\r\\n\\r\\n                \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"log\\\">\\r\\n    <div class=\\\"grid-row\\\">\\r\\n        <div class=\\\"col-7\\\">\\r\\n            <section class=\\\"log-browser\\\">\\r\\n                <header>\\r\\n                    <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Log watcher\", options) : helperMissing.call(depth0, \"__\", \"Log watcher\", options)))\n    + \"</h2>\\r\\n                    <div class=\\\"header-buttons\\\">\\r\\n                        <button class=\\\"btn-info export js-export\\\"><span class=\\\"icon-export\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Export log entries\", options) : helperMissing.call(depth0, \"__\", \"Export log entries\", options)))\n    + \"</button>\\r\\n                    </div>\\r\\n                </header>\\r\\n                <div class=\\\"log-table-filters\\\"></div>\\r\\n                <div class=\\\"log-table\\\"></div>\\r\\n            </section>\\r\\n        </div>\\r\\n        <div class=\\\"col-5\\\">\\r\\n            <section class=\\\"event-viewer hidden\\\">\\r\\n                <div class=\\\"grid-row\\\">\\r\\n                    <div class=\\\"col-10\\\">\\r\\n                        <h3>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Event\", options) : helperMissing.call(depth0, \"__\", \"Event\", options)))\n    + \" #<span class=\\\"id\\\"></span></h3>\\r\\n                    </div>\\r\\n                </div>\\r\\n\\r\\n                \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.dataTypes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\\r\\n            </section>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoEventLog/components/export/templates/layout', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<div class=\\\"mp-export-modal\\\">\\r\\n    <h1>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h1>\\r\\n    <form class=\\\"grid-row js-export-form\\\">\\r\\n        <div class=\\\"col-12\\\">\\r\\n            <h2>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"CSV Options\", options) : helperMissing.call(depth0, \"__\", \"CSV Options\", options)))\n    + \"</h2>\\r\\n            <div class=\\\"grid-row\\\">\\r\\n                <label class=\\\"col-5\\\" for=\\\"field_delimiter\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Field delimiter\", options) : helperMissing.call(depth0, \"__\", \"Field delimiter\", options)))\n    + \"</label>\\r\\n                <input class=\\\"col-7\\\" name=\\\"field_delimiter\\\" id=\\\"field_delimiter\\\" size=\\\"2\\\" value=\\\";\\\" type=\\\"text\\\">\\r\\n            </div>\\r\\n            <div class=\\\"grid-row\\\">\\r\\n                <label class=\\\"col-5\\\" for=\\\"field_encloser\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Field encloser\", options) : helperMissing.call(depth0, \"__\", \"Field encloser\", options)))\n    + \"</label>\\r\\n                <input class=\\\"col-7\\\" name=\\\"field_encloser\\\" size=\\\"2\\\" value='\\\"' type=\\\"text\\\">\\r\\n            </div>\\r\\n            <div class=\\\"grid-row\\\">\\r\\n                <label class=\\\"col-5\\\" for=\\\"multi_values_delimiter\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Multiple values delimiter\", options) : helperMissing.call(depth0, \"__\", \"Multiple values delimiter\", options)))\n    + \"</label>\\r\\n                <input class=\\\"col-7\\\" name=\\\"multi_values_delimiter\\\" size=\\\"2\\\" value='|' type=\\\"text\\\">\\r\\n            </div>\\r\\n            <label class=\\\"grid-row\\\">\\r\\n                <div class=\\\"col-5\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"First row column names\", options) : helperMissing.call(depth0, \"__\", \"First row column names\", options)))\n    + \"</div>\\r\\n                <div class=\\\"col-7\\\">\\r\\n                    <input type=\\\"checkbox\\\" name=\\\"first_row_column_names\\\" checked>\\r\\n                    <span class=\\\"icon-checkbox\\\"></span>\\r\\n                </div>\\r\\n            </label>\\r\\n            <button type=\\\"submit\\\" class=\\\"btn-success\\\"><span class=\\\"icon-upload\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Export\", options) : helperMissing.call(depth0, \"__\", \"Export\", options)))\n    + \"</button>\\r\\n        </div>\\r\\n    </form>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Ivan Klimchuk <klimchuk@1pt.com>\r\n */\r\n\r\ndefine('taoEventLog/components/export/exporter',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/component',\r\n    'ui/feedback',\r\n    'layout/loading-bar',\r\n    'tpl!taoEventLog/components/export/templates/layout',\r\n    'util/url',\r\n    'layout/logout-event',\r\n    'jquery.fileDownload'\r\n], function ($, _, __, component, feedback, loadingBar, layoutTpl, url, logoutEvent) {\r\n    'use strict';\r\n\r\n    /**\r\n     * @param {Object} options - the component configuration\r\n     * @returns {exporter} a new component\r\n     */\r\n    return function exporter(options) {\r\n        if (!_.isPlainObject(options) || !_.isString(options.exportUrl)) {\r\n            throw new TypeError('The exporter must be configured with exportUrl option');\r\n        }\r\n\r\n        return component({}, { title: __('Export') })\r\n            .setTemplate(layoutTpl)\r\n\r\n            // renders the component\r\n            .on('render', function () {\r\n                var self = this,\r\n                    $form = self.$component.find('.js-export-form');\r\n\r\n                $form.on('submit', function (e) {\r\n                    e.preventDefault();\r\n                    loadingBar.start();\r\n\r\n                    var params = {},\r\n                        exportUrl;\r\n\r\n                    _.each($form.serializeArray(), function(param){\r\n                        params[param.name] = param.value;\r\n                    });\r\n\r\n                    exportUrl = url.build(options.exportUrl, params);\r\n\r\n                    $.fileDownload(exportUrl, {\r\n                        successCallback : function () {\r\n                            loadingBar.stop();\r\n                            self.$component.modal('close');\r\n                        },\r\n                        failCallback : function (jqXHR) {\r\n                            loadingBar.stop();\r\n                            var response = $.parseJSON($(jqXHR).text());\r\n                            if (response) {\r\n                                feedback().error(new Error(response.message));\r\n                            } else {\r\n                                self.$component.modal('close');\r\n                                logoutEvent();\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            })\r\n            .init(options);\r\n    }\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Ivan Klimchuk <klimchuk@1pt.com>\r\n */\r\n\r\ndefine('taoEventLog/components/export/modalExporter',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/feedback',\r\n    'taoEventLog/components/export/exporter',\r\n    'ui/modal'\r\n], function ($, _, __, feedback, exporter) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Wrap the exporter in a modal popup\r\n     *\r\n     * @param {Object} options - the exporter's configuration\r\n     * @param {String} exportUrl\r\n     */\r\n    return function modalExporter(options) {\r\n\r\n        var feedbackOptions = {\r\n            timeout: {\r\n                warning: 8000\r\n            },\r\n            encodeHtml: false\r\n        };\r\n\r\n        return exporter(options)\r\n            .on('warning', function (err) {\r\n                feedback().warning(err, feedbackOptions);\r\n            })\r\n            .on('error', function (err) {\r\n                feedback().error(err, feedbackOptions);\r\n            })\r\n            .on('render', function () {\r\n                var self = this;\r\n                this.$component\r\n                    .addClass('modal')\r\n                    .on('close.modal', function () {\r\n                        self.$component.modal('close');\r\n                    })\r\n                    .modal({ width: 600 });\r\n            })\r\n            .render('body');\r\n    };\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\r\n */\r\n\r\ndefine('taoEventLog/controller/TaoEventLog/show',[\r\n    'jquery',\r\n    'i18n',\r\n    'helpers',\r\n    'ui/datatable',\r\n    'tpl!taoEventLog/controller/TaoEventLog/show/layout',\r\n    'taoEventLog/components/export/modalExporter',\r\n    'ui/dateRange'\r\n], function ($, __, helpers, datatable, layoutTpl, exporter, dateRangeFactory) {\r\n    'use strict';\r\n\r\n    //the endpoints\r\n    var listUrl = helpers._url('search', 'TaoEventLog', 'taoEventLog');\r\n\r\n    return {\r\n\r\n        /**\r\n         * Controller entry point\r\n         */\r\n        start: function start() {\r\n\r\n            var data = {\r\n                dataTypes: [\r\n                    {key: 'event_name', title: __('Event Name')},\r\n                    {key: 'action', title: __('Action')},\r\n                    {key: 'user_id', title: __('User ID')},\r\n                    {key: 'user_roles', title: __('User Roles')},\r\n                    {key: 'occurred', title: __('Occurred')},\r\n                    {key: 'properties', title: __('Properties')}\r\n                ]\r\n            };\r\n\r\n            var $layout = $(layoutTpl(data));\r\n            var $eventFilter = $('.log-browser .log-table-filters', $layout);\r\n            var $eventList = $('.log-browser .log-table', $layout);\r\n            var $eventViewer = $('.event-viewer', $layout);\r\n            var $exportLink = $('.js-export', $layout);\r\n\r\n            var $filterRange = dateRangeFactory({\r\n                pickerType: 'datetimepicker',\r\n                renderTo: $eventFilter,\r\n                pickerConfig: {\r\n                    // configurations from lib/jquery.timePicker.js\r\n                    dateFormat: 'yy-mm-dd',\r\n                    timeFormat: 'HH:mm:ss'\r\n                }\r\n            });\r\n\r\n            $filterRange.on('submit', function() {\r\n\r\n                $eventList.datatable('options', {\r\n                    params: {\r\n                        periodStart: $filterRange.getStart(),\r\n                        periodEnd: $filterRange.getEnd()\r\n                    }\r\n                });\r\n\r\n                $eventList.datatable('refresh');\r\n            });\r\n\r\n\r\n            var updateEventDetails = function updateEventDetails(event) {\r\n                for (var k in event) {\r\n                    if (event.hasOwnProperty(k)) {\r\n                        if (k == 'properties') {\r\n                            var json = JSON.parse(JSON.parse(event[k]));\r\n                            var str = JSON.stringify(json, undefined, 2);\r\n                            $('.' + k, $eventViewer).html(\r\n                                '<pre>' + str + '</pre>'\r\n                            );\r\n                        } else if (k == 'user_roles') {\r\n                            $('.' + k, $eventViewer).html(event['user_roles'].split(',').join('<br>'));\r\n                        } else {\r\n                            $('.' + k, $eventViewer).html(event[k]);\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n\r\n            $exportLink.on('click', function () {\r\n                exporter({\r\n                    title: __('Export Log Entries'),\r\n                    exportUrl: helpers._url('export', 'TaoEventLog', 'taoEventLog')\r\n                });\r\n            });\r\n\r\n            //append the layout to the current view container\r\n            $('.content').append($layout);\r\n\r\n            //set up the student list\r\n            $eventList.datatable({\r\n                url: listUrl,\r\n                sortby: 'occurred',\r\n                sortorder: 'desc',\r\n                filter: true,\r\n                rowSelection: true,\r\n                filterStrategy: 'multiple',\r\n                model: [{\r\n                    id: 'identifier',\r\n                    label: __('ID'),\r\n                    transform: function (id, row) {\r\n                        return row.raw.id;\r\n                    }\r\n                }, {\r\n                    id: 'event_name',\r\n                    label: __('Event Name'),\r\n                    sortable: true,\r\n                    filterable: true\r\n                }, {\r\n                    id: 'action',\r\n                    label: __('Action'),\r\n                    sortable: true,\r\n                    filterable: true\r\n                }, {\r\n                    id: 'user_id',\r\n                    label: __('User ID'),\r\n                    sortable: true,\r\n                    filterable: true\r\n                }, {\r\n                    id: 'user_roles',\r\n                    label: __('User Roles'),\r\n                    sortable: true,\r\n                    filterable: true,\r\n                    transform: function (roles) {\r\n                        return roles.split(', ').shift();\r\n                    }\r\n                }, {\r\n                    id: 'occurred',\r\n                    label: __('Occurred'),\r\n                    sortable: true\r\n                }],\r\n\r\n                listeners: {\r\n                    /**\r\n                     * When a row is selected, we update the student viewer\r\n                     */\r\n                    selected: function selectRow(e, event) {\r\n                        updateEventDetails(event.raw);\r\n\r\n                        //the 1st time it comes hidden\r\n                        $eventViewer.removeClass('hidden');\r\n                    },\r\n\r\n                    /**\r\n                     * Set pagination to start position when using filtering\r\n                     * @param e\r\n                     * @param options\r\n                     */\r\n                    filter: function filtered(e, options) {\r\n                        options.page = 1;\r\n                    }\r\n\r\n                }\r\n            }).on('create.datatable', function () {\r\n                // the page is now ready\r\n                $layout.trigger('dispatched');\r\n            });\r\n        }\r\n    };\r\n});\r\n\n"]}